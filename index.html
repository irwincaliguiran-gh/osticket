<!DOCTYPE html>
<html>
<head>
  <title>Project Ticketing System</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 1000px; margin: auto; }
    input, textarea, select, button { width: 100%; margin-bottom: 10px; padding: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 30px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h2>Submit a Project Ticket</h2>
  <form id="ticketForm">
    <input type="text" name="ticketId" id="ticketId" readonly />
    <input type="text" name="projectNumber" placeholder="Project Number" required />
    <input type="text" name="projectName" placeholder="Project Name" required />
    <input type="text" name="projectManager" placeholder="Project Manager" required />
    <input type="number" name="budget" placeholder="Budget" required />
    <input type="date" name="startDate" required />
    <input type="date" name="endDate" required />
    <select name="priorityLevel" required>
      <option value="">Priority Level</option>
      <option value="Low">Low</option>
      <option value="Medium">Medium</option>
      <option value="High">High</option>
    </select>
    <input type="text" name="assignedTeam" placeholder="Assigned Team" required />
    <textarea name="remarks" placeholder="Remarks"></textarea>
    <button type="submit">Submit Ticket</button>
  </form>

  <p id="response"></p>

  <h2>Submitted Tickets</h2>
  <table id="ticketTable">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Ticket ID</th>
        <th>Project Number</th>
        <th>Project Name</th>
        <th>Project Manager</th>
        <th>Budget</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Priority Level</th>
        <th>Assigned Team</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById('ticketForm');
    const responseMsg = document.getElementById('response');
    const tableBody = document.querySelector("#ticketTable tbody");
    const scriptURL = "AKfycbytGt0HTLF7QjJDBWNlZOZ8tMAWraJyBFQkDiLMXF7x"; // Replace with your actual Web App URL

    function generateTicketId() {
      const now = new Date();
      return "TKT-" +
        now.getFullYear().toString().slice(-2) +
        ("0" + (now.getMonth() + 1)).slice(-2) +
        ("0" + now.getDate()).slice(-2) + "-" +
        ("0" + now.getHours()).slice(-2) +
        ("0" + now.getMinutes()).slice(-2) +
        ("0" + now.getSeconds()).slice(-2);
    }

    document.getElementById("ticketId").value = generateTicketId();

    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const data = {
        ticketId: form.ticketId.value,
        projectNumber: form.projectNumber.value,
        projectName: form.projectName.value,
        projectManager: form.projectManager.value,
        budget: form.budget.value,
        startDate: form.startDate.value,
        endDate: form.endDate.value,
        priorityLevel: form.priorityLevel.value,
        assignedTeam: form.assignedTeam.value,
        remarks: form.remarks.value
      };
      fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(data),
        headers: { "Content-Type": "application/json" }
      })
      .then(res => res.text())
      .then(msg => {
        responseMsg.innerText = "Ticket submitted successfully!";
        form.reset();
        document.getElementById("ticketId").value = generateTicketId();
        loadTickets();
      })
      .catch(err => {
        responseMsg.innerText = "Error submitting ticket.";
      });
    });

    function loadTickets() {
      fetch(scriptURL)
        .then(response => response.json())
        .then(data => {
          tableBody.innerHTML = "";
          data.forEach(ticket => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${ticket.Timestamp}</td>
              <td>${ticket["Ticket ID"]}</td>
              <td>${ticket["Project Number"]}</td>
              <td>${ticket["Project Name"]}</td>
              <td>${ticket["Project Manager"]}</td>
              <td>${ticket.Budget}</td>
              <td>${ticket["Start Date"]}</td>
              <td>${ticket["End Date"]}</td>
              <td>${ticket["Priority Level"]}</td>
              <td>${ticket["Assigned Team"]}</td>
              <td>${ticket.Remarks}</td>
            `;
            tableBody.appendChild(row);
          });
        })
        .catch(error => {
          console.error("Error loading tickets:", error);
        });
    }

    loadTickets();
  </script>
</body>
</html>
